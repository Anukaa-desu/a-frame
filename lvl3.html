<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Level 3 - The Whispering Door</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
    }
  </style>
</head>
<body>
  <a-scene background="color: #0d0d0d" fog="type: exponential; color: #0d0d0d; density: 0.05">

    <!-- Lights -->
    <a-light type="ambient" color="#555"></a-light>
    <a-light type="point" position="0 5 0" intensity="1.5" color="#B39DDB"></a-light>

    <!-- Ground -->
    <a-plane rotation="-90 0 0" width="30" height="30" color="#111"></a-plane>

    <!-- Camera & Cursor
    <a-entity id="rig" position="0 1.6 8">
        <a-camera raycaster="objects: .clickable" cursor="rayOrigin: mouse; fuse: false"></a-camera>
    </a-entity> -->

    <!-- Camera -->
    <a-entity position="0 1.6 4">
      <a-camera>
        <a-cursor fuse="false" rayOrigin="mouse" material="color: cyan; shader: flat" position="0 0 -1"></a-cursor>
      </a-camera>
    </a-entity>

    <!-- Whispering Orb -->
    <a-sphere id="orb" position="0 3 -2" radius="0.3" color="#E1BEE7"
              animation="property: scale; dir: alternate; dur: 1000; loop: true; to: 1.2 1.2 1.2">
    </a-sphere>
    <a-text id="clueText" value="..." align="center" position="0 2.4 -2" color="#fff" width="6"></a-text>

    <!-- Doors -->
    <a-box id="door1" class="door clickable" position="-6 1 -5" width="1.5" height="3" depth="0.1" color="#5C6BC0"></a-box>
    <a-box id="door2" class="door clickable" position="-2 1 -5" width="1.5" height="3" depth="0.1" color="#8E24AA"></a-box>
    <a-box id="door3" class="door clickable" position="2 1 -5" width="1.5" height="3" depth="0.1" color="#00897B"></a-box>
    <a-box id="door4" class="door clickable" position="6 1 -5" width="1.5" height="3" depth="0.1" color="#F4511E"></a-box>

    <!-- Door Labels -->
    <a-text value="1" position="-6 3.2 -5" color="#fff" width="2" align="center"></a-text>
    <a-text value="2" position="-2 3.2 -5" color="#fff" width="2" align="center"></a-text>
    <a-text value="3" position="2 3.2 -5" color="#fff" width="2" align="center"></a-text>
    <a-text value="4" position="6 3.2 -5" color="#fff" width="2" align="center"></a-text>

    <!-- Fade Screen -->
    <a-plane id="fade" visible="false" position="0 1.6 -3" width="20" height="20" color="#000" material="opacity: 0.8; transparent: true"></a-plane>

  </a-scene>

  <script>
    window.onload = () => {
      const clues = [
        "The correct door is not the first.", //1
        "The door to the right of the correct one is red.", //3
        "The third door is lying.", //3
        // "The safe path is hidden in plain sight.",
        // "Trust not the second door.",
        // "The answer lies between lies.",
        "The leftmost door is a trap." //3
      ];

      const correctDoorIndex = Math.floor(Math.random() * 4) + 1;
      const clueText = document.querySelector('#clueText');
      const doors = document.querySelectorAll('.door');
      const fade = document.querySelector('#fade');

      const clue = clues[Math.floor(Math.random() * clues.length)];
      clueText.setAttribute('value', clue);

      doors.forEach(door => {
        door.addEventListener('click', () => {
          const selected = parseInt(door.id.replace('door', ''));

          if (selected === correctDoorIndex) {
            door.setAttribute('color', '#00E676');
            clueText.setAttribute('value', 'You chose wisely...');
            setTimeout(() => {
              window.location.href = 'lvl4.html';
            }, 1500);
          } else {
            door.setAttribute('color', '#D32F2F');
            clueText.setAttribute('value', 'The whisper misled you...');
            fade.setAttribute('visible', 'true');
            setTimeout(() => {
              location.reload();
            }, 2000);
          }
        });
      });
    };
  </script>
</body>
</html>